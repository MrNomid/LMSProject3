{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–µ–∫–∞ -->
    <div class="d-flex justify-content-end mb-5">
        <a class="btn btn-primary btn-lg shadow-sm px-4 fw-bold hover-lift" href="/load_track"
           style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
            <i class="bi bi-cloud-arrow-up-fill me-2"></i>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç—Ä–µ–∫
        </a>
    </div>

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–∑–¥–µ–ª–∞ -->
    <div class="mb-4">
        <h2 class="fw-bold">üéµ –ú–æ–∏ —Ç—Ä–µ–∫–∏</h2>
        <p class="text-muted">–ó–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ —Ç—Ä–µ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏</p>
        <hr class="mb-4">
    </div>

    <!-- –°–µ—Ç–∫–∞ —Ç—Ä–µ–∫–æ–≤ -->
    <div class="row g-4">
        {% for track in tracks %}
        <div class="col-lg-6 col-xl-4">
            <div class="card h-100 shadow-sm border-0 hover-lift">
                <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞ -->
                <div class="position-relative">
                    <a href="/{{ track.image }}">
                        <img src="{{ track.image }}"
                             class="card-img-top"
                             style="height: 200px; object-fit: cover;"
                             alt="{{ track.name }}">
                    </a>
                    <!-- –ë–µ–π–¥–∂ —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
                    <div class="position-absolute top-0 end-0 m-3">
                        <div class="rating-badge bg-success bg-opacity-25 text-dark fw-bold px-3 py-2 rounded-pill shadow-sm">
                            <i class="bi bi-star-fill me-1"></i>
                            <span>{{ track.rating }}</span>
                        </div>
                    </div>
                </div>

                <div class="card-body">
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—Ä–µ–∫–µ -->
                    <div class="mb-3">
                        <h5 class="card-title fw-bold mb-2">{{ track.name }}</h5>

                        <!-- –ñ–∞–Ω—Ä—ã -->
                        <div class="mb-3">
                            <span class="badge bg-primary bg-opacity-10 text-dark border border-primary border-opacity-25 px-3 py-2">
                                <i class="bi bi-music-note-list me-1"></i>{{ track.genres }}
                            </span>
                        </div>

                        <!-- –ê—É–¥–∏–æ–ø–ª–µ–µ—Ä -->
                        <div class="mb-4">
                            <audio controls class="w-100 custom-audio-player">
                                <source src="{{ track.track_file }}" type="audio/mpeg">
                            </audio>
                        </div>

                        <!-- –û–ø–∏—Å–∞–Ω–∏–µ (—Å–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–µ) -->
                        <div class="mb-3">
                            <h6 class="text-muted mb-2">–û–ø–∏—Å–∞–Ω–∏–µ:</h6>
                            <div class="bg-light p-3 rounded-3" style="max-height: 100px; overflow: auto;">
                                <p class="mb-0 small">{{ track.description[:150] }}{% if track.description|length > 150 %}...{% endif %}</p>
                            </div>
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                    <div class="d-flex gap-2 flex-wrap">
                        <a class="btn btn-danger flex-fill" href="/delete/{{ track.id }}">
                            <i class="bi bi-trash me-1"></i>–£–¥–∞–ª–∏—Ç—å
                        </a>
                        <a class="btn btn-primary flex-fill" href="/comment/{{ track.id }}">
                            <i class="bi bi-chat-left-text me-1"></i>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                        </a>

                        <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–ª–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è -->
                        <button type="button" class="btn btn-outline-secondary flex-fill"
                                data-bs-toggle="modal" data-bs-target="#descriptionModal{{ track.id }}">
                            <i class="bi bi-info-circle me-1"></i>–ü–æ–¥—Ä–æ–±–Ω–µ–µ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø–æ–ª–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º -->
        <div class="modal fade" id="descriptionModal{{ track.id }}" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header border-0">
                        <h5 class="modal-title">üìù –û–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞ "{{ track.name }}"</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="d-flex align-items-center mb-4">
                            <img src="{{ track.image }}" width="80" height="80" class="rounded me-3">
                            <div>
                                <h6 class="mb-0 fw-bold">{{ track.name }}</h6>
                                <div class="badge bg-primary bg-opacity-10 text-dark mt-1">
                                    {{ track.genres }}
                                </div>
                            </div>
                        </div>

                        <div class="card bg-light border-0">
                            <div class="card-body">
                                <h6 class="mb-3">–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:</h6>
                                <p class="mb-0" style="white-space: pre-wrap; line-height: 1.6;">
                                    {{ track.description }}
                                </p>
                            </div>
                        </div>

                        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç—Ä–µ–∫–∞ -->
                        <div class="row mt-4 g-3">
                            <div class="col-6">
                                <div class="p-3 bg-success bg-opacity-10 rounded-3 text-center">
                                    <div class="text-success mb-1">
                                        <i class="bi bi-star-fill"></i>
                                    </div>
                                    <h4 class="mb-0">{{ track.rating }}</h4>
                                    <small class="text-bald">–†–µ–π—Ç–∏–Ω–≥</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ—Ç —Ç—Ä–µ–∫–æ–≤ -->
    {% if not tracks %}
    <div class="text-center py-5">
        <div class="display-1 mb-3">üéµ</div>
        <h3 class="mb-3">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤</h3>
        <p class="text-muted mb-4">–ù–∞—á–Ω–∏—Ç–µ –¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–µ–π –º—É–∑—ã–∫–æ–π —Å —Å–æ–æ–±—â–µ—Å—Ç–≤–æ–º!</p>
        <a class="btn btn-primary btn-lg px-4 fw-bold hover-lift" href="/load_track"
           style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
            <i class="bi bi-cloud-arrow-up-fill me-2"></i>–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤—ã–π —Ç—Ä–µ–∫
        </a>
    </div>
    {% endif %}
</div>

<style>
    /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –∫–∞–∫ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ */
    .hover-lift {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .hover-lift:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
    }

    .custom-audio-player {
        border-radius: 10px;
        background: #f8f9fa;
    }

    .custom-audio-player::-webkit-media-controls-panel {
        background: #f8f9fa;
        border-radius: 10px;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .col-lg-6, .col-xl-4 {
        animation: fadeIn 0.5s ease forwards;
    }

    .col-lg-6:nth-child(1) { animation-delay: 0.1s; }
    .col-lg-6:nth-child(2) { animation-delay: 0.2s; }
    .col-lg-6:nth-child(3) { animation-delay: 0.3s; }

    /* –°—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è */
    .btn-danger:hover {
        background: linear-gradient(135deg, #dc3545 0%, #a71d2a 100%);
        border-color: transparent;
        transform: scale(1.05);
    }

    /* –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */
    .btn-outline-primary:hover {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-color: transparent;
        color: white;
    }

    /* –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è */
    .bg-light::-webkit-scrollbar {
        width: 6px;
    }

    .bg-light::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    .bg-light::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 10px;
    }
</style>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

<script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ–ø–ª–µ–µ—Ä–æ–≤
    document.addEventListener('DOMContentLoaded', function() {
        const audioPlayers = document.querySelectorAll('audio');
        audioPlayers.forEach(player => {
            player.addEventListener('play', function() {
                // –ü—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥—Ä—É–≥–∏–µ –ø–ª–µ–µ—Ä—ã –ø—Ä–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ
                audioPlayers.forEach(otherPlayer => {
                    if (otherPlayer !== player) {
                        otherPlayer.pause();
                    }
                });
            });
        });

        // –ü–ª–∞–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫
        const cards = document.querySelectorAll('.col-lg-6, .col-xl-4');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            setTimeout(() => {
                card.style.animation = `fadeIn 0.5s ease forwards`;
                card.style.animationDelay = `${0.1 * (index + 1)}s`;
            }, 100);
        });
    });
</script>
{% endblock %}